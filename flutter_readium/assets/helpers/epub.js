var epub;(()=>{var e={324:(e,t,n)=>{"use strict";n.r(t)},679:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initResponsiveTables=function(){let e=Array.from(document.querySelectorAll("table"));if(e=e.filter((e=>!e.classList.contains("docx-table")&&!e.classList.contains("transparent-table")&&!e.classList.contains("plain-table"))),!e||0===e.length)return;e.forEach((e=>{if(function(e){let t=0,n=0;if(e.querySelectorAll("tr").forEach((e=>{e.querySelectorAll("td").forEach((e=>{""===e.textContent.trim()?t++:n++}))})),t>n)return e.classList.add("plain-table"),!0;return!1}(e))return;const t=e.querySelectorAll("thead th").length,n=e.querySelectorAll("tbody tr");if(1===t&&Array.from(n).every((e=>2===e.querySelectorAll("td").length))){const t=n[0].querySelectorAll("td");if(Array.from(t).every((e=>e.querySelector("strong")||Array.from({length:6},((t,n)=>e.querySelector(`h${n+1}`))).some((e=>null!==e)))))return void e.classList.add("plain-table");!function(e){const t=e.querySelector("thead th").textContent,n=Array.from(e.querySelectorAll("tbody td"));e.innerHTML="";const o=document.createElement("tbody"),r=document.createElement("tr"),i=document.createElement("tr");r.innerHTML="<td>&#160;</td>",i.innerHTML=`<td>${t}</td>`,n.forEach(((e,t)=>{if(t%2==0){const t=document.createElement("td");t.innerHTML=`<h3>${e.textContent}</h3>`,r.appendChild(t)}else{const t=document.createElement("td");Array.from(e.childNodes).forEach((e=>t.appendChild(e.cloneNode(!0)))),i.appendChild(t)}})),o.appendChild(r),o.appendChild(i),e.appendChild(o)}(e)}!function(e){let t=null,n=[];if(e.tHead)t=e.tHead.rows[0],n=Array.from(t.cells);else{const o=e.rows[0];o&&o.querySelector("th, h1, h2, h3, h4, h5, h6, strong")&&(t=o,n=Array.from(o.cells),e.classList.add("has-first-row-headers"))}if(n.length){e.classList.add("has-header");const o=n.map((e=>{var t;let n=(null===(t=e.textContent)||void 0===t?void 0:t.trim())||"";return n.length&&(n+=":"),n}));Array.from(e.rows).filter((e=>e!==t)).forEach((e=>{if(Array.from(e.cells).forEach(((e,t)=>{e.setAttribute("data-th",o[t]||"")})),!e.cells[0].getAttribute("data-th")){e.cells[0].classList.add("mobile-header");const t=document.createElement("h6");t.textContent=e.cells[0].textContent,e.cells[0].textContent="",e.cells[0].appendChild(t)}}))}}(e)}))}},50:e=>{self,e.exports=(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return"object"==typeof e&&null!==e&&e.nodeType===Node.ELEMENT_NODE}e.r(t),e.d(t,{default:()=>X,getCssSelector:()=>J});const o={NONE:"",DESCENDANT:" ",CHILD:" > "},r={id:"id",class:"class",tag:"tag",attribute:"attribute",nthchild:"nthchild",nthoftype:"nthoftype"},i="CssSelectorGenerator";function l(e="unknown problem",...t){console.warn(`${i}: ${e}`,...t)}const s={selectors:[r.id,r.class,r.tag,r.attribute],includeTag:!1,whitelist:[],blacklist:[],combineWithinSelector:!0,combineBetweenSelectors:!0,root:null,maxCombinations:Number.POSITIVE_INFINITY,maxCandidates:Number.POSITIVE_INFINITY};function c(e){return e instanceof RegExp}function a(e){return["string","function"].includes(typeof e)||c(e)}function d(e){return Array.isArray(e)?e.filter(a):[]}function u(e){const t=[Node.DOCUMENT_NODE,Node.DOCUMENT_FRAGMENT_NODE,Node.ELEMENT_NODE];return function(e){return e instanceof Node}(e)&&t.includes(e.nodeType)}function h(e,t){if(u(e))return e.contains(t)||l("element root mismatch","Provided root does not contain the element. This will most likely result in producing a fallback selector using element's real root node. If you plan to use the selector using provided root (e.g. `root.querySelector`), it will nto work as intended."),e;const n=t.getRootNode({composed:!1});return u(n)?(n!==document&&l("shadow root inferred","You did not provide a root and the element is a child of Shadow DOM. This will produce a selector using ShadowRoot as a root. If you plan to use the selector using document as a root (e.g. `document.querySelector`), it will not work as intended."),n):t.ownerDocument.querySelector(":root")}function f(e){return"number"==typeof e?e:Number.POSITIVE_INFINITY}function g(e=[]){const[t=[],...n]=e;return 0===n.length?t:n.reduce(((e,t)=>e.filter((e=>t.includes(e)))),t)}function m(e){return[].concat(...e)}function v(e){const t=e.map((e=>{if(c(e))return t=>e.test(t);if("function"==typeof e)return t=>{const n=e(t);return"boolean"!=typeof n?(l("pattern matcher function invalid","Provided pattern matching function does not return boolean. It's result will be ignored.",e),!1):n};if("string"==typeof e){const t=new RegExp("^"+e.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".+")+"$");return e=>t.test(e)}return l("pattern matcher invalid","Pattern matching only accepts strings, regular expressions and/or functions. This item is invalid and will be ignored.",e),()=>!1}));return e=>t.some((t=>t(e)))}function p(e,t,n){const o=Array.from(h(n,e[0]).querySelectorAll(t));return o.length===e.length&&e.every((e=>o.includes(e)))}function _(e,t){t=null!=t?t:function(e){return e.ownerDocument.querySelector(":root")}(e);const o=[];let r=e;for(;n(r)&&r!==t;)o.push(r),r=r.parentElement;return o}function b(e,t){return g(e.map((e=>_(e,t))))}const y=", ",N=new RegExp(["^$","\\s"].join("|")),S=new RegExp(["^$"].join("|")),E=[r.nthoftype,r.tag,r.id,r.class,r.attribute,r.nthchild],L=v(["class","id","ng-*"]);function C({name:e}){return`[${e}]`}function T({name:e,value:t}){return`[${e}='${t}']`}function w({nodeName:e,nodeValue:t}){return{name:j(e),value:j(t)}}function x(e){const t=Array.from(e.attributes).filter((t=>function({nodeName:e},t){const n=t.tagName.toLowerCase();return!(["input","option"].includes(n)&&"value"===e||L(e))}(t,e))).map(w);return[...t.map(C),...t.map(T)]}function P(e){return(e.getAttribute("class")||"").trim().split(/\s+/).filter((e=>!S.test(e))).map((e=>`.${j(e)}`))}function O(e){const t=e.getAttribute("id")||"",n=`#${j(t)}`,o=e.getRootNode({composed:!1});return!N.test(t)&&p([e],n,o)?[n]:[]}function A(e){const t=e.parentNode;if(t){const o=Array.from(t.childNodes).filter(n).indexOf(e);if(o>-1)return[`:nth-child(${o+1})`]}return[]}function R(e){return[j(e.tagName.toLowerCase())]}function I(e){const t=[...new Set(m(e.map(R)))];return 0===t.length||t.length>1?[]:[t[0]]}function $(e){const t=I([e])[0],n=e.parentElement;if(n){const o=Array.from(n.children).filter((e=>e.tagName.toLowerCase()===t)),r=o.indexOf(e);if(r>-1)return[`${t}:nth-of-type(${r+1})`]}return[]}function k(e=[],{maxResults:t=Number.POSITIVE_INFINITY}={}){return Array.from(function*(e=[],{maxResults:t=Number.POSITIVE_INFINITY}={}){let n=0,o=D(1);for(;o.length<=e.length&&n<t;){n+=1;const t=o.map((t=>e[t]));yield t,o=M(o,e.length-1)}}(e,{maxResults:t}))}function M(e=[],t=0){const n=e.length;if(0===n)return[];const o=[...e];o[n-1]+=1;for(let e=n-1;e>=0;e--)if(o[e]>t){if(0===e)return D(n+1);o[e-1]++,o[e]=o[e-1]+1}return o[n-1]>t?D(n+1):o}function D(e=1){return Array.from(Array(e).keys())}const q=":".charCodeAt(0).toString(16).toUpperCase(),F=/[ !"#$%&'()\[\]{|}<>*+,./;=?@^`~\\]/;function j(e=""){var t,n;return null!==(n=null===(t=null===CSS||void 0===CSS?void 0:CSS.escape)||void 0===t?void 0:t.call(CSS,e))&&void 0!==n?n:function(e=""){return e.split("").map((e=>":"===e?`\\${q} `:F.test(e)?`\\${e}`:escape(e).replace(/%/g,"\\"))).join("")}(e)}const H={tag:I,id:function(e){return 0===e.length||e.length>1?[]:O(e[0])},class:function(e){return g(e.map(P))},attribute:function(e){return g(e.map(x))},nthchild:function(e){return g(e.map(A))},nthoftype:function(e){return g(e.map($))}},V={tag:R,id:O,class:P,attribute:x,nthchild:A,nthoftype:$};function B(e){return e.includes(r.tag)||e.includes(r.nthoftype)?[...e]:[...e,r.tag]}function W(e={}){const t=[...E];return e[r.tag]&&e[r.nthoftype]&&t.splice(t.indexOf(r.tag),1),t.map((t=>{return(o=e)[n=t]?o[n].join(""):"";var n,o})).join("")}function U(e,t,n="",r){const i=function(e,t){return""===t?e:function(e,t){return[...e.map((e=>t+o.DESCENDANT+e)),...e.map((e=>t+o.CHILD+e))]}(e,t)}(function(e,t,n){const o=function(e,t){const{blacklist:n,whitelist:o,combineWithinSelector:r,maxCombinations:i}=t,l=v(n),s=v(o);return function(e){const{selectors:t,includeTag:n}=e,o=[].concat(t);return n&&!o.includes("tag")&&o.push("tag"),o}(t).reduce(((t,n)=>{const o=function(e,t){var n;return(null!==(n=H[t])&&void 0!==n?n:()=>[])(e)}(e,n),c=function(e=[],t,n){return e.filter((e=>n(e)||!t(e)))}(o,l,s),a=function(e=[],t){return e.sort(((e,n)=>{const o=t(e),r=t(n);return o&&!r?-1:!o&&r?1:0}))}(c,s);return t[n]=r?k(a,{maxResults:i}):a.map((e=>[e])),t}),{})}(e,n),r=function(e,t){return function(e){const{selectors:t,combineBetweenSelectors:n,includeTag:o,maxCandidates:r}=e,i=n?k(t,{maxResults:r}):t.map((e=>[e]));return o?i.map(B):i}(t).map((t=>function(e,t){const n={};return e.forEach((e=>{const o=t[e];o.length>0&&(n[e]=o)})),function(e={}){let t=[];return Object.entries(e).forEach((([e,n])=>{t=n.flatMap((n=>0===t.length?[{[e]:n}]:t.map((t=>Object.assign(Object.assign({},t),{[e]:n})))))})),t}(n).map(W)}(t,e))).filter((e=>e.length>0))}(o,n),i=m(r);return[...new Set(i)]}(e,r.root,r),n);for(const t of i)if(p(e,t,r.root))return t;return null}function Y(e){return{value:e,include:!1}}function G({selectors:e,operator:t}){let n=[...E];e[r.tag]&&e[r.nthoftype]&&(n=n.filter((e=>e!==r.tag)));let o="";return n.forEach((t=>{(e[t]||[]).forEach((({value:e,include:t})=>{t&&(o+=e)}))})),t+o}function z(e){return[":root",..._(e).reverse().map((e=>{const t=function(e,t,n=o.NONE){const r={};return t.forEach((t=>{Reflect.set(r,t,function(e,t){return V[t](e)}(e,t).map(Y))})),{element:e,operator:n,selectors:r}}(e,[r.nthchild],o.CHILD);return t.selectors.nthchild.forEach((e=>{e.include=!0})),t})).map(G)].join("")}function J(e,t={}){const o=function(e){(e instanceof NodeList||e instanceof HTMLCollection)&&(e=Array.from(e));const t=(Array.isArray(e)?e:[e]).filter(n);return[...new Set(t)]}(e),i=function(e,t={}){const n=Object.assign(Object.assign({},s),t);return{selectors:(o=n.selectors,Array.isArray(o)?o.filter((e=>{return t=r,n=e,Object.values(t).includes(n);var t,n})):[]),whitelist:d(n.whitelist),blacklist:d(n.blacklist),root:h(n.root,e),combineWithinSelector:!!n.combineWithinSelector,combineBetweenSelectors:!!n.combineBetweenSelectors,includeTag:!!n.includeTag,maxCombinations:f(n.maxCombinations),maxCandidates:f(n.maxCandidates)};var o}(o[0],t);let l="",c=i.root;function a(){return function(e,t,n="",o){if(0===e.length)return null;const r=[e.length>1?e:[],...b(e,t).map((e=>[e]))];for(const e of r){const t=U(e,0,n,o);if(t)return{foundElements:e,selector:t}}return null}(o,c,l,i)}let u=a();for(;u;){const{foundElements:e,selector:t}=u;if(p(o,t,i.root))return t;c=e[0],l=t,u=a()}return o.length>1?o.map((e=>J(e,i))).join(y):function(e){return e.map(z).join(y)}(o)}const X=J;return t})()}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};(()=>{"use strict";var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.EpubPage=void 0;const t=n(50),r=n(679);n(324);class i{constructor(){this._headingTagNames=["h1","h2","h3","h4","h5","h6"],this._activeLocationId="activeLocation",this._locationTag="span",this._documentRange=document.createRange(),document.documentElement.style.setProperty("-webkit-line-box-contain","block inline replaced")}isReaderReady(){return!!readium}setLocation(e,t){var n,o,r,i,l,s,c,a,d,u;this._debugLog(e);try{if(null==e)return void this._debugLog("No locator set");if(this._removeLocation(),this._setLocation(e,t),this._isComicBook()){const t=null!==(s=null!==(o=null===(n=null==e?void 0:e.locations)||void 0===n?void 0:n.cssSelector)&&void 0!==o?o:null===(l=null===(i=null===(r=null==e?void 0:e.locations)||void 0===r?void 0:r.domRange)||void 0===i?void 0:i.start)||void 0===l?void 0:l.cssSelector)&&void 0!==s?s:null===(d=null===(a=null===(c=null==e?void 0:e.locations)||void 0===c?void 0:c.domRange)||void 0===a?void 0:a.end)||void 0===d?void 0:d.cssSelector;if(null==t)return void this._errorLog("Css selector not set!");const h=this._getDurationFragment(null===(u=null==e?void 0:e.locations)||void 0===u?void 0:u.fragments);if(null==h)return void this._errorLog("Duration not set!");window.GotoComicFrame(t,1e3*h)}}catch(e){this._errorLog(e)}}scrollToLocations(e,t,n){try{const o=this._processLocations(e);if(null!=o)return void this._scrollToProcessedRange(o,t,n);const r=e.progression;if(null!=r)return void this._scrollToProgression(r,t);this._debugLog("ScrollToLocations: Unknown range",e)}catch(e){this._errorLog(e)}}isLocatorVisible(e){var t,n,o;this._debugLog(e);try{const r=e.locations,i=null!==(t=r.cssSelector)&&void 0!==t?t:null===(o=null===(n=r.domRange)||void 0===n?void 0:n.start)||void 0===o?void 0:o.cssSelector;if(this._isComicBook()){const e=null!=document.querySelector(i);return this._debugLog("Comic book",r,{found:e,selector:i}),e}const l=this._processLocations(r);return null==l?(this._debugLog("isLocatorVisible: Unknown range",r),!1):this._isProcessedRangeVisible(l)&&!!document.querySelector(`${i} #${this._activeLocationId}`)}catch(e){return this._errorLog(e),!0}}getLocatorFragments(e,t){var n,o,r,i;try{const l=null!==(o=null===(n=null==e?void 0:e.locations)||void 0===n?void 0:n.cssSelector)&&void 0!==o?o:this._findFirstVisibleCssSelector();if(null==l||!(null==l?void 0:l.length))return this._debugLog("getLocatorFragments: selector not found, returning locator from args"),e;const s=[...this._getPageFragments(t),...this._getTocFragments(l),...this._getPhysicalPageFragments(l)];return Object.assign(Object.assign({},e),{locations:Object.assign(Object.assign({cssSelector:l},e.locations),{fragments:[...null!==(i=null===(r=e.locations)||void 0===r?void 0:r.fragments)&&void 0!==i?i:[],...s]})})}catch(t){return this._errorLog(t),e}}_isComicBook(){try{return!!(null===comicBookPage||void 0===comicBookPage?void 0:comicBookPage.isComicBook())}catch(e){return!1}}_isTextNode(e){const t=e.nodeType;return 3===t||4===t}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}_findAndSplitOffset(e,t){return function e(n){if(3===n.nodeType||4===n.nodeType){const e=n;if(t<=0)return e;const o=e.length;if(t<o)return e.splitText(t);t-=o}const o=n.childNodes,r=o.length;for(let t=0;t<r;++t){const n=e(o[t]);if(null!=n)return n}return null}(e)}_nextNodeNotChild(e){var t;return e&&(null!==(t=e.nextSibling)&&void 0!==t?t:this._nextNodeNotChild(e.parentNode))}_nextNode(e){var t,n;return e&&(null!==(n=null!==(t=e.firstChild)&&void 0!==t?t:e.nextSibling)&&void 0!==n?n:this._nextNodeNotChild(e.parentNode))}_previousNodeNotChild(e){var t;return e&&(null!==(t=e.previousSibling)&&void 0!==t?t:this._previousNodeNotChild(e.parentNode))}_previousNode(e){var t,n;return e&&(null!==(n=null!==(t=e.lastChild)&&void 0!==t?t:e.previousSibling)&&void 0!==n?n:this._previousNodeNotChild(e.parentNode))}_findNonWhitespaceForward(e,t){for(;null!=e;){if(this._isTextNode(e)){const n=e.data;for(t=Math.max(t,0);t<n.length;){if(""!==n[t].trim())return{node:e,charOffset:t};++t}t=0}e=this._nextNode(e)}}_findNonWhitespaceBackward(e,t){for(;null!=e;){if(this._isTextNode(e)){const n=e.data,o=n.length-1;for(t=Math.min(null!=t?t:o,o);t>=0;){if(""!==n[t].trim())return{node:e,charOffset:t};--t}t=void 0}e=this._previousNode(e)}}_findNonWhitespace(e,t){var n;return null!==(n=this._findNonWhitespaceBackward(e,t))&&void 0!==n?n:this._findNonWhitespaceForward(e,t)}_setLocation(e,t){var n,o,r,i,l,s,c,a,d,u,h;const f=readium.link;this._debugLog("create:",e,f);const g=e.locations,m=null!==(n=g.cssSelector)&&void 0!==n?n:null===(r=null===(o=null==g?void 0:g.domRange)||void 0===o?void 0:o.start)||void 0===r?void 0:r.cssSelector;if(!m)return void this._errorLog("Start css selector not found");const v=document.querySelector(m);if(!v)return void this._errorLog("Start parent not found");const p=null!==(l=null===(i=null==g?void 0:g.domRange)||void 0===i?void 0:i.end.cssSelector)&&void 0!==l?l:m,_=p===m?v:document.querySelector(p);if(!_)return void this._errorLog("End parent not found");const b=null===(c=null===(s=null==g?void 0:g.domRange)||void 0===s?void 0:s.start)||void 0===c?void 0:c.charOffset,y=null===(d=null===(a=null==g?void 0:g.domRange)||void 0===a?void 0:a.end)||void 0===d?void 0:d.charOffset;if(!b&&!y&&t)return void this._wrapWithLocationElement(v);const N=null!==(u=this._findAndSplitOffset(v,b))&&void 0!==u?u:this._nextNodeNotChild(v),S=null!==(h=this._findAndSplitOffset(_,y))&&void 0!==h?h:this._nextNodeNotChild(_),E=new Array;for(let e=N;e&&e!==S;e=this._nextNode(e))this._isTextNode(e)&&E.push(e);for(const e of E){const t=this._setLocationElement();t.appendChild(e.cloneNode(!0)),e.replaceWith(t)}}_removeLocation(){this._debugLog("Remove old location");const e=document.querySelectorAll(`#${this._activeLocationId}`);null==e||e.forEach((e=>{if(this._isAndroid())return void e.removeAttribute("id");const t=e.parentNode;e.replaceWith(...e.childNodes),t.normalize()}))}_safeVisibleRect(e){const{innerWidth:t,innerHeight:n}=window;return e?{left:0,top:.05*n,right:t,bottom:.95*n}:{left:0,top:0,right:t,bottom:n}}*_descendentTextNodes(e){if(this._isTextNode(e))yield e;else for(const t of e.childNodes)yield*this._descendentTextNodes(t)}_findTextPosition(e,t){if(null!=e)if(t<0||isNaN(t))this._errorLog(`findTextPosition: invalid charOffset, node=${e.nodeValue}, charOffset=${t}`);else{if(0===t)return{node:e,charOffset:t};for(const n of this._descendentTextNodes(e)){const e=n.length;if(t<=e)return{node:n,charOffset:t};t-=e}this._errorLog(`findTextPosition: failed, node=${this._debugNode(e)}, charOffset=${t}`)}else this._errorLog(`findTextPosition: no node, charOffset=${t}`)}_processDomRange(e){const{start:t,end:n}=e,{cssSelector:o,charOffset:r}=t,{cssSelector:i,charOffset:l}=null!=n&&void 0!==n?n:t,s=document.querySelector(o),c=this._findTextPosition(s,null!=r?r:0);if(null==c)return void this._errorLog(`DomRange bad start, selector=${o}`);const a=i===o?s:document.querySelector(i),d=this._findTextPosition(a,null!=l&&void 0!==l?l:0);if(null!=d){try{this._documentRange.setStart(c.node,c.charOffset)}catch(e){this._errorLog(`${this._debugNode(c.node)}, ${c.charOffset}`,e),this._documentRange.setStartAfter(c.node)}try{this._documentRange.setEnd(d.node,d.charOffset)}catch(e){this._errorLog(`${this._debugNode(d.node)}, ${d.charOffset}`,e),this._documentRange.setEndAfter(d.node)}if(0===this._documentRange.getClientRects().length){const e=this._findNonWhitespace(c.node,c.charOffset);if(null==e)return void this._errorLog("Couldn't find any non-whitespace characters in the document!'");const{node:t,charOffset:n}=e;this._documentRange.setStart(t,n),this._documentRange.setEnd(t,n+1)}return this._documentRange}this._errorLog(`DomRange bad end, selector=${i}`)}_processCssSelector(e){const t=document.querySelector(e);if(null!=t)return"none"===window.getComputedStyle(t).display&&(t.style.display=this._isPageBreakElement(t)?"flex":"block"),this._documentRange.selectNode(t),this._documentRange;this._errorLog(`processCssSelector: error: node not found ${e}`)}_processLocations(e){var t,n,o;if(null==e)return void this._errorLog("location not set");if(e.domRange)return this._processDomRange(e.domRange);const r=null!==(t=e.cssSelector)&&void 0!==t?t:null===(o=null===(n=e.domRange)||void 0===n?void 0:n.start)||void 0===o?void 0:o.cssSelector;return r?this._processCssSelector(r):void 0}_scrollToProcessedRange(e,t,n){!n&&this._isProcessedRangeVisible(e)||this._scrollToBoundingClientRect(e,t)}_scrollToProgression(e,t){null===readium||void 0===readium||readium.scrollToPosition(e,"ltr")}_scrollToBoundingClientRect(e,t){const{top:n,right:o,bottom:r,left:i}=e.getBoundingClientRect();if(0===n&&0===o&&0===r&&0===i)return void this._debugLog("scrollToBoundingClientRect: Scrolling to defective bounding rect, abort! ",e.getClientRects(),e.getClientRects().length);const{scrollLeft:l,scrollWidth:s,scrollTop:c,scrollHeight:a}=document.scrollingElement;if(t){const{top:e,bottom:o}=this._safeVisibleRect(t);if(n<e||r>o){const t=this._clamp((c+n-e)/a,0,1);null===readium||void 0===readium||readium.scrollToPosition(t,"ltr")}}else{const e=(l+.5*(i+o))/s;null===readium||void 0===readium||readium.scrollToPosition(e,"ltr")}}_isProcessedRangeVisible(e){const{innerWidth:t,innerHeight:n}=window,{top:o,right:r,bottom:i,left:l}=e.getBoundingClientRect();return o<n&&0<i&&l<t&&0<r}_getPageFragments(e){try{const{scrollLeft:t,scrollWidth:n}=document.scrollingElement,{innerWidth:o}=window,r=e?null:Math.round(t/o)+1;return[`page=${r}`,`totalPages=${e?null:Math.round(n/o)}`]}catch(e){return this._errorLog(e),[]}}_getDurationFragment(e){try{const t=e.find((e=>e.includes("duration=")));if(!t)return void this._errorLog("Duration fragment not found.");const n=/duration=(\d+(?:\.\d+)?)/.exec(t);return n?(this._debugLog("Duration fragment:",n[1]),parseFloat(n[1])):void this._errorLog("Invalid duration format.")}catch(e){return void this._errorLog("Could not retrieve duration fragment!")}}_getTocFragments(e){var t;try{const n=null===(t=this._findPrecedingAncestorSiblingHeadings(e)[0])||void 0===t?void 0:t.id;return null==n?[]:[`toc=${n}`]}catch(e){return this._errorLog(e),[]}}_getPhysicalPageFragments(e){try{const t=this._findCurrentPhysicalPage(e);return null==t?[]:[`physicalPage=${t}`]}catch(t){return this._errorLog(`Selector:${e} -- ${t}`),[]}}_findPrecedingAncestorSiblingHeadings(e){var t,n;const o=document.querySelector(e),r=null!==(t=null==o?void 0:o.querySelectorAll(this._headingTagNames.join(","))[0])&&void 0!==t?t:o;if(null==r)return;if(!this._allHeadings){const e=Array.from(window.document.querySelectorAll(this._headingTagNames.join(",")));for(const t of e)if(t){const e=t,n=e.textContent||e.getAttribute("title")||e.getAttribute("aria-label");let o=e.getAttribute("id");if(!o){let t,n=e;for(;(t=n.parentNode)&&(null==t?void 0:t.nodeType)===Node.ELEMENT_NODE&&t.firstElementChild===n;){const e=t.getAttribute("id");if(e){o=e;break}n=t}}const r={element:e,id:o||null,level:parseInt(e.localName.substring(1),10),text:n};this._allHeadings||(this._allHeadings=[]),this._allHeadings.push(r)}this._allHeadings||(this._allHeadings=[])}let i;for(let e=this._allHeadings.length-1;e>=0;e--){const t=this._allHeadings[e],n=r.compareDocumentPosition(t.element);(0===n||n&Node.DOCUMENT_POSITION_PRECEDING||n&Node.DOCUMENT_POSITION_CONTAINS)&&(i||(i=[]),(null==t?void 0:t.id)&&i.push({id:t.id,level:t.level,text:t.text}))}if(null==i?void 0:i.length)return i;const l=null!==(n=o.closest("section"))&&void 0!==n?n:o.closest("body");return l?[{id:l.id,level:0,text:l.innerText}]:void 0}_isPageBreakElement(e){return null!=e&&"pagebreak"===e.getAttribute("type")}_getPhysicalPageIndexFromElement(e){var t;return null!==(t=null==e?void 0:e.getAttribute("title"))&&void 0!==t?t:null==e?void 0:e.innerText.trim()}_findPhysicalPageIndex(e){if(!(null!=e&&e instanceof Element))return null;if(this._isPageBreakElement(e))return this._getPhysicalPageIndexFromElement(e);const t=null==e?void 0:e.querySelector(".page-normal, .page-front, .page-special");return null==t?null:this._getPhysicalPageIndexFromElement(t)}_getAllSiblings(e){var t;const n=[];e=null===(t=null==e?void 0:e.parentNode)||void 0===t?void 0:t.firstChild;do{3!==(null==e?void 0:e.nodeType)&&n.push(e)}while(e=null==e?void 0:e.nextSibling);return n}_findCurrentPhysicalPage(e){var t;let n=document.querySelector(e);if(null!=n){if(this._isPageBreakElement(n))return this._getPhysicalPageIndexFromElement(n);for(;n.nodeType===Node.ELEMENT_NODE;){const e=this._getAllSiblings(n);if(null==e)return;for(let t=e.findIndex((e=>null==e?void 0:e.isEqualNode(n)));t>=0;t--){const n=e[t],o=this._findPhysicalPageIndex(n);if(null!=o)return o}if(n=n.parentNode,null==n||"body"===n.nodeName.toLowerCase())return null===(t=document.querySelector("head [name='webpub:currentPage']"))||void 0===t?void 0:t.getAttribute("content")}}}_findFirstVisibleCssSelector(){return this._getCssSelector(this._getFirstVisibleElement())}_getCssSelector(e){var n,o;try{const r=(0,t.getCssSelector)(e,{root:document.querySelector("body")}),i=null!==(o=null===(n=null==r?void 0:r.replace(":root > :nth-child(2)","body"))||void 0===n?void 0:n.trim())&&void 0!==o?o:"body";return this._debugLog(i),i}catch(e){return this._errorLog(e),"body"}}_getFirstVisibleElement(){const e=this._findFirstVisibleElement(document.body);return this._debugLog("First visible element:",{tagName:e.nodeName.toLocaleLowerCase(),id:e.id,className:e.className}),e}_findFirstVisibleElement(e){const t={tagName:e.nodeName.toLocaleLowerCase(),id:e.id,className:e.className};for(const n of e.children){const o={tagName:n.nodeName.toLocaleLowerCase(),id:n.id,className:n.className};if(this._isElementVisible(n))if(this._shouldIgnoreElement(n))this._debugLog("Element is ignored - continue",o);else{if(n.id.includes(`${this._activeLocationId}`))return this._debugLog("Child is an active location element, return closest element with id",{childData:o,nodeData:t}),e.id?e:this._findClosestElementWithId(n);if(n.hasChildNodes())return this._debugLog("Loop into children",o),this._findFirstVisibleElement(n);if(!n.id)return this._debugLog("Element has no ID attribute - return closest element with id",o),e.id?e:this._findClosestElementWithId(n)}}return this._debugLog("return:",t),e}_findClosestElementWithId(e){let t=e.parentElement;for(;null!==t;){if(t.id)return t;t=t.parentElement}return this._debugLog("No element with id attr found!"),e}_isElementVisible(e,t=!1){if(null===readium||void 0===readium?void 0:readium.isFixedLayout)return!0;if(e===document.body||e===document.documentElement)return!0;if(!document||!document.documentElement||!document.body)return!1;const n=e.getBoundingClientRect();return t?this._isScrollModeEnabled()?n.top>=0&&n.top<=document.documentElement.clientHeight:n.left>=1:this._isScrollModeEnabled()?n.bottom>0&&n.top<window.innerHeight:n.right>0&&n.left<window.innerWidth}_shouldIgnoreElement(e){const t=window.getComputedStyle(e);if(t){if("none"===t.getPropertyValue("display"))return!0;if("0"===t.getPropertyValue("opacity"))return!0}return this._isElementEmpty(e)}_isElementEmpty(e){return"img"!==e.tagName.toLowerCase()&&""===e.textContent.trim()}_wrapWithLocationElement(e){const t=e;if(t){const e=this._setLocationElement();for(;t.firstChild;){const n=t.firstChild;t.removeChild(n),e.appendChild(n)}t.appendChild(e)}}_setLocationElement(){const e=document.createElement(this._locationTag);return e.id=this._activeLocationId,e}_isScrollModeEnabled(){const e=document.documentElement.style;return"readium-scroll-on"===e.getPropertyValue("--USER__view").trim()||"readium-scroll-on"===e.getPropertyValue("--USER__scroll").trim()}_debugLog(...e){this._log("======================================================="),this._log(e),this._log("=======================================================")}_log(...e){this.isIos()?null===webkit||void 0===webkit||webkit.messageHandlers.log.postMessage([].slice.call(e).map((e=>e instanceof String?`${e}`:`${JSON.stringify(e)}`)).join(", ")):console.log(JSON.stringify(e))}_debugNode(e){var t,n;if(e instanceof Node){return(new XMLSerializer).serializeToString(e)}if("innerHTML"in e||"textContent"in e){const o=e;return null!==(n=null!==(t=o.innerHTML)&&void 0!==t?t:o.textContent)&&void 0!==n?n:"?"}}_errorLog(...e){var t;this._log("v===v===v===v===v===v"),this._log("Error:",e),this._log("Stack:",null!==(t=null==e?void 0:e.stack)&&void 0!==t?t:(new Error).stack.replace("\n","->").replace("_errorLog","")),this._log("^===^===^===^===^===^")}isIos(){try{return isIos}catch(e){return!1}}_isAndroid(){try{return isAndroid}catch(e){return!1}}}function l(){window.epubPage||((0,r.initResponsiveTables)(),document.removeEventListener("DOMContentLoaded",l),window.epubPage=new i)}e.EpubPage=i,"loading"!==document.readyState?window.setTimeout(l):document.addEventListener("DOMContentLoaded",l)})(),epub=o})();
